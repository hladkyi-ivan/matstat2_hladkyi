---
title: "Лабораторна робота № 3. Основи вибіркового методу"
author: "Гладкий Іван"
output:
  pdf_document:
    latex_engine: xelatex
    highlight: tango
geometry: margin=1in
fontsize: 14pt
mainfont: "Times New Roman"
lang: ru
editor_options:
chunk_output_type: console
---


__Мета:__ _засвоїти основи статистичного оцінювання характеристик випадкової величини на основі вибіркового підходу засобами мови програмування R; набути навичок роботи у середовищі RStudio із застосуванням концепції "грамотного програмування" із застосуванням пакету R Markdown_. 



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE, include=FALSE}
packages <- c("beeswarm", "moments", "Hmisc")
# install.packages(packages)
lapply(packages, library, character.only=TRUE)
```



### 1. Постановка задачі



```{r, include=FALSE}

a <- -1
s <- 1
n <- 100
```


Випадкова величина $X$ має нормальний закон розподілу: $X\sim F(a,\sigma^2)$, тобто $X\sim N(a,\sigma^2)$, вектор параметрів $\Theta=(a,\sigma^2)$  якого відомий:  $(a,\sigma^2)=($ `r a` $,$ `r s` $)$ . Тобто, $a=$ `r a`, $\sigma^2=$ `r s`. Згенерувати дві вибірки  випадкової величини $X$ за допомогою відповідного генератору псевдовипадкових чисел: $(x_1,x_2,...,x_n)$  відповідно обсягів $n=100$ та $n=1000$, що мають розподіл  $X\sim N($ `r a`, `r s^2` $)$, обчислити і дослідити оцінки параметрів розподілу $\tilde{a}=\tilde{a}(x_1,x_2,...,x_n)\approx a$,   $\tilde{\sigma}=\tilde{\sigma}(x_1,x_2,...,x_n)=\sigma$ та інші статистичні характеристики, зробити порівняльний аналіз оцінених характеристик між собою і з теоретичними характеристиками. Для цього необхідно:

1. Побудувати статистичний розподіл у вигляді інтервальної таблиці відносних частот.

1. Побудувати гістограму, теоретичну $f(x,a,\sigma)$ та емпіричну $f^*(x,\tilde{a},\tilde{\sigma})$ функції щільності на одному графіку.

1. Побудувати графіки теоретичної $F(x,a,\sigma)$ та емпіричної $F^*(x,\tilde{a},\tilde{\sigma})$ функції розподілу.

1. Побудувати п'ятиквантильний графік (boxplot) "ящик з вусами".

1. Обчислити точкові незміщені і конзістентні оцінки вектору параметрів розподілу  $(a,\sigma^2)$, математичного сподівання $m(x)$, дисперсії $D(x)$, СКВ $\sigma(x)$, центральних теоретичних моментів $3$-го $\mu_3$   і $4$-ого  $\mu_4$ порядків, асиметрії $A_s$ та ексцесу $E_k$:

  - написавши власну користувацьку функцію;
  
  - за допомогою вбудованих засобів R.  
6. Дані звести у таблицю:


:Таблиця 1 -- __Теоретичні та емпіричні (вибіркові) числові характеристики випадкової величини__


Назва числової характеристики | теоретичне значення | Вибіркове значення, $n=100$ | Вибіркове значення, $n=1000$ |
--------|----|------|---------
$a$|$a$| $\tilde a$ | $\tilde a$
$\sigma$|$\sigma$|$\tilde{\sigma}$|${\tilde{\sigma}}$
Математичне сподівання|$m(x)$|$\tilde{m}(x)$|$\tilde{m}(x)$
Дисперсія|$D(x)$|$\tilde{D}(x)$|$\tilde{D}(x)$
Виправлена дисперсія||$\tilde{\tilde{D}}(x)$|$\tilde{\tilde{D}}(x)$
СКВ|$\sigma(x)$|$\tilde{\sigma}(x)$|$\tilde{\sigma}(x)$
Виправлене СКВ||$\tilde{\tilde\sigma}(x)$|$\tilde{\tilde\sigma}(x)$
Центральний момент $3$-го порядку|$\mu_3$|$\tilde{\mu}_3$|$\tilde{\mu}_3$
Центральний момент $4$-го порядку|$\mu_4$|$\tilde{\mu}_4$|$\tilde{\mu}_4$
Асимерія|$A_s$|$\tilde{A}_s$|$\tilde{A}_s$
Ексцес|$E_k$|$\tilde{E}_k$|$\tilde{E}_k$


### 1. Виконання роботи 



Генеруємо вибірку з нормального розподілу з параметрами $a=$ `r a`, $\sigma=$ `r s` об'єму $n=$ `r n`:

```{r, echo=TRUE, message=FALSE, warning=FALSE}
set.seed(0) # фіксація параметрів генератора псевдовипадкових чисел 
X <- rnorm(n, a, s) # генератор нормального розподілу
cat("\n", "Параметри вибірки:", "\n", "a = ", a, "\n" , "s = ", s, "\n" , "n = ", n, "\n")
cat("Перші елементи вибірки:", head(X))
cat("Останні елементи вибірки:", tail(X))
```


Будуємо варіаційний ряд.

```{r}
SortX <- sort(X) # варіаційний ряд
plot(SortX, col=4)
title("Варіаційний ряд - доля значень")
# dev.off()
```

Будуємо інтервальний статистичний розподіл і гістограму частот.

```{r}
1 + 1.332 * log(n)

# За замовчанням - "Sturges", заголовок відсутній
table(cut(X, nclass.Sturges(X))) # Вивід інтревального варіаційного ряду
hist(X, breaks=nclass.Sturges(X),
     col="Lightblue",
     main="Гістограма частот") # Кількість карманів за Стерджессом
```

Гістограма відносних частот.

```{r}


hist(X,
     freq = FALSE,
     col = "Lightblue",
     main = "Гістограма відносних частот")
curve(dnorm(x, a, s), col = 2, lty = 2, lwd = 2, add = TRUE) # теоретична крива щільності розподілу
curve(dnorm(x, mean(X), sd(X)), col = 3, lty = 2, lwd = 2, add = TRUE) # емпірична крива щільності розподілу
```

Сумарні статистики.

Вивід сумарних статистик.

```{r}
summary(X)
```
Можна так:

:Таблиця 2 -- __Числові характеристики вибірки__

Характеристика | Значення
-----|-----
$\tilde{m}(x)$| `r mean(X)`
$\tilde{\tilde{\sigma}}(x)$| `r sd(X)`
$\tilde{R}$| `r IQR(X)`


Функція `describe()` з пакету `Hmisc` надає можливість вивести цілу низку сумарних оцінок характеристик вибірки:
```{r}
describe(X)

```

А можна написати власну функцію.

```{r}

my_summary <- function(X, ...) {
  cat("\n", "Оцінки статистичних характеристик вибірки:", "\n", 
      "вибіркове математичне сподівання, m = ", mean(X), "\n",
      "Медіана, Ме = ", median(X) , "\n",
      "вибіркова дисперсія, s^2 = ", var(X), "\n" ,
      "вибіркове СКВ, s = ", sd(X), "\n" ,
      "Розмах, R = ", max(X) - min(X), "\n" ,
      "Інтерквартільний розмах, IQR = ", IQR(X), "\n",
      "Ексцес, Ek = ", kurtosis(X), "\n",
      "Асиметрія, As= ", skewness(X), "\n"
    )
}

my_summary(X,  na.rm=FALSE)


```



Ще один варіант представлення теоретичного і емпіричного розподілів.

```{r}
plot(density(X, adjust=2), main="X", col=4)
rug(X, col=2) # Виділення місць точками з наібільшою щільністю значень
```

Емпірична функція росподілу F(x).

F(x) з числом інтервалів за Стерджессом.

```{r}
# Fn <- ecdf(table(cut(X, nclass.Sturges(X))))

Fn <- ecdf(X)


## luxury plot
plot(Fn,
     verticals = TRUE,
     col.points = "blue",
     col.hor = "red",
     col.vert = "bisque",
     main = "Емпірична функція розподілу")
```

Побудова боксплотів (ящиків з вусами).

```{r}
# Ще одна альтернатива - "графік-вулик"
boxplot(X, main="box-plot X")  # вивід боксплоту
beeswarm(X, col=2, add=TRUE) # ДОДАВАННЯ "рою" з ефектом jutter
```

На практиці оптимальним може бути компактний варіант виводу основних графіків вибіркових характеристик. Наприклад, такий.

```{r}
op <- par(mfrow = c(2,2))
          
# Гістограма відносних частот 
hist(X,
     freq = FALSE,
     col = "Lightgray",
     main="Histogram",
     border=4)

curve(dnorm(x, a, s),
      col = 2,
      lty = 2,
      lwd = 2,
      add = TRUE) # крива щільності

plot(Fn,
     main = "Quantile Plot",
     verticals = TRUE,
     col.points = "blue",
     col.hor = "red",
     col.vert = "bisque",
     xlab = "X",
     ylab = "Fn(x)")

boxplot(X,
        main = "Box-and-Wisker Plot",
        col = "Lightgray",
        border = 4,
        xlab = "X",
        ylab = "",
        horizontal = TRUE)  # боксплот

beeswarm(X,
         col = 2,
         add = TRUE,
         horizontal = TRUE) # ДОДАВАННЯ "рою" з ефектом jutter

plot(density(X, adjust=2),
     main = "density trace",
     xlab = "X",
     ylab = "Dencity",
     col="blue")

rug(X,
    col=2,
    main="fn(x)") # Виділення точками місць з найбільшою щільністю значень

par(op) #Повертаємо параметри за замовчанням          
```

__Результати моделювання зводимо у таблицю.__

:Таблиця 3 -- __Теоретичні та емпіричні (вибіркові) числові характеристики випадкової величини__


Назва числової характеристики | теоретичне значення | Вибіркове значення, $n=$ `r n` | Вибіркове значення, $n=1000$ |
--------|----|------|---------
$a$|`r a`| `r mean(X)` | $\tilde a$
$\sigma$|`r s`|`r sd(X)`|${\tilde{\sigma}}$
Математичне сподівання|`r a`|`r mean(X)`|$\tilde{m}(x)$
Дисперсія|`r s^2`|`r var(X)`|$\tilde{D}(x)$
Виправлена дисперсія||`r var(X)*n/(n-1)`|$\tilde{\tilde{D}}(x)$
СКВ|`r s`|`r sd(X)`|$\tilde{\sigma}(x)$
Виправлене СКВ||`r sqrt(var(X)*n/(n-1))`|$\tilde{\tilde\sigma}(x)$
Центральний момент $3$-го порядку|$\mu_3$|$\tilde{\mu}_3$|$\tilde{\mu}_3$
Центральний момент $4$-го порядку|$\mu_4$|$\tilde{\mu}_4$|$\tilde{\mu}_4$
Асимерія|$A_s$|$\tilde{A}_s$|$\tilde{A}_s$
Ексцес|$E_k$|$\tilde{E}_k$|$\tilde{E}_k$
 

  


## Контрольні Питання


### 1. Вибірка — це підмножина даних, обрана з генеральної сукупності для дослідження її властивостей.

### 2. Вибіркове математичне сподівання оцінюється за допомогою середнього арифметичного. Воно є точковою оцінкою математичного сподівання генеральної сукупності.

### 3. Дисперсія, дисперсія, середнє квадратичне відхилення, коефіцієнт варіації.

### 4. Асиметрія, Ексцес.

## Висновок

### На цьому занятті я засвоїв основи статистичного оцінювання характеристик випадкової величини на основі вибіркового підходу засобами мови програмування R; набув навичок роботи у середовищі RStudio із застосуванням концепції "грамотного програмування" із застосуванням пакету R Markdown